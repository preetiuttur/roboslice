<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>RoboSlice - Staff Order Home</title>
  <style>
    :root {
      --blue: #006491;
      --red: #e31837;
      --gold: #ffb84d;
      --bg: #0f172a;
      --card-bg: #020617;
      --panel-bg: #020617;
      --border: #1e293b;
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --shadow-soft: 0 16px 40px rgba(15, 23, 42, 0.7);
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background:
        radial-gradient(circle at top left, rgba(0,100,145,0.30), transparent 55%),
        radial-gradient(circle at top right, rgba(227,24,55,0.25), transparent 55%),
        var(--bg);
      color: var(--text-main);
    }

    .shell {
      max-width: 1200px;
      margin: 0 auto;
      padding: 16px 20px 32px;
    }

    /* Header */
    .header {
      background: radial-gradient(circle at top left, rgba(255,255,255,0.1), transparent 65%),
                  linear-gradient(135deg, #020617, #020617);
      border-radius: 20px;
      padding: 14px 20px;
      box-shadow: var(--shadow-soft);
      display: flex;
      align-items: center;
      justify-content: space-between;
      color: #fff;
      margin-bottom: 18px;
      border: 1px solid rgba(148,163,184,0.35);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-box {
      width: 38px;
      height: 38px;
      border-radius: 10px;
      background:
        conic-gradient(from 225deg,
          var(--red) 0 25%,
          #fff 25% 50%,
          var(--blue) 50% 75%,
          #fff 75% 100%);
      border: 2px solid rgba(255,255,255,0.95);
      box-shadow: 0 0 0 2px rgba(0,0,0,0.5);
    }

    .header-title h1 {
      margin: 0;
      font-size: 19px;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }
    .header-title span {
      font-size: 11px;
      opacity: .86;
    }

    .staff-pill {
      background: rgba(15,23,42,0.8);
      padding: 5px 11px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .staff-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: #4ade80;
      box-shadow: 0 0 0 3px rgba(74,222,128,0.35);
    }

    .section-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    /* Pizza card grid */
    .card {
      background: radial-gradient(circle at top left, rgba(255,255,255,0.03), transparent 55%),
                  var(--card-bg);
      border-radius: 20px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow-soft);
      padding: 14px 16px;
    }

    .card-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 16px;
    }
    @media (max-width: 900px) {
      .card-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }
    @media (max-width: 600px) {
      .card-grid {
        grid-template-columns: 1fr;
      }
    }

    .pizza-card {
      background: #020617;
      border-radius: 18px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      border: 1px solid #1e293b;
    }

    .pizza-img {
      position: relative;
      height: 140px;
      background-size: cover;
      background-position: center;
    }

    .pizza-name-overlay {
      position: absolute;
      left: 12px;
      bottom: 12px;
      font-size: 15px;
      font-weight: 700;
      color: #fff;
      text-shadow: 0 2px 4px rgba(0,0,0,0.8);
    }

    .pizza-body {
      padding: 9px 11px 10px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      flex: 1;
    }

    .pizza-title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .pizza-title-text {
      font-weight: 600;
      font-size: 14px;
    }

    .veg-dot {
      width: 12px;
      height: 12px;
      border-radius: 2px;
      border: 1px solid #059669;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: #022c22;
    }
    .veg-dot-inner {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #16a34a;
    }

    .pizza-desc {
      font-size: 12px;
      color: var(--text-muted);
    }

    .card-bottom {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 6px;
    }

    .price {
      font-size: 15px;
      font-weight: 700;
      color: #e5e7eb;
    }
    .price small {
      font-size: 11px;
      font-weight: 400;
      color: var(--text-muted);
      display: block;
    }

    .add-btn {
      border: none;
      border-radius: 999px;
      background: linear-gradient(135deg, var(--red), #ff6f4d);
      color: #fff;
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      padding: 6px 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      box-shadow: 0 8px 18px rgba(227,24,55,0.55);
      transition: transform 0.08s, box-shadow 0.08s, filter 0.08s;
    }
    .add-btn span.dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: #fff;
    }
    .add-btn:hover {
      filter: brightness(1.05);
      transform: translateY(-1px);
      box-shadow: 0 10px 22px rgba(227,24,55,0.7);
    }
    .add-btn:active {
      transform: translateY(1px);
      box-shadow: 0 5px 12px rgba(0,0,0,0.6);
    }

    /* ORDER PANEL (form + QR side by side) */
    .order-panel {
      margin-top: 18px;
      background: radial-gradient(circle at top left, rgba(255,255,255,0.04), transparent 60%),
                  var(--panel-bg);
      border-radius: 22px;
      border: 1px solid rgba(148,163,184,0.4);
      box-shadow: var(--shadow-soft);
      padding: 16px 18px 18px;
    }

    .order-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.5fr) minmax(0, 1fr);
      gap: 24px;
    }
    @media (max-width: 900px) {
      .order-grid {
        grid-template-columns: 1fr;
      }
    }

    .order-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .order-sub {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 14px;
    }

    .field-label {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    input[type="text"],
    select {
      width: 100%;
      padding: 8px 11px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: #020617;
      color: var(--text-main);
      font-size: 12px;
      outline: none;
      transition: border 0.15s, box-shadow 0.15s, background 0.15s;
    }
    input[type="text"]:focus,
    select:focus {
      border-color: var(--gold);
      box-shadow: 0 0 0 1px rgba(248,250,252,0.5);
      background: #020617;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px 14px;
      margin-bottom: 12px;
    }
    @media (max-width: 700px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
    }

    .cart-header {
      font-size: 13px;
      font-weight: 600;
      margin: 10px 0 4px;
    }
    .cart-sub {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    table.cart-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      margin-bottom: 4px;
    }
    .cart-table th,
    .cart-table td {
      padding: 5px 4px;
      text-align: left;
    }
    .cart-table th {
      font-weight: 600;
      color: var(--text-muted);
      border-bottom: 1px solid #1f2937;
    }
    .cart-table td:last-child,
    .cart-table th:last-child {
      text-align: right;
    }

    .cart-empty {
      font-size: 12px;
      color: var(--text-muted);
      margin: 4px 0 6px;
    }

    .qty-controls {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      border-radius: 999px;
      background: #020617;
      border: 1px solid #1f2937;
      padding: 2px 6px;
    }
    .qty-btn {
      border: none;
      background: transparent;
      font-size: 12px;
      cursor: pointer;
      padding: 0 4px;
      color: var(--text-main);
    }
    .qty-value {
      font-size: 12px;
      min-width: 14px;
      text-align: center;
    }

    .cart-total-row {
      display: flex;
      justify-content: flex-end;
      margin-top: 4px;
      font-size: 13px;
      font-weight: 600;
    }
    .cart-total-row span.amount {
      margin-left: 6px;
      color: var(--gold);
      font-size: 16px;
    }

    .place-order-btn {
      margin-top: 14px;
      width: 100%;
      padding: 11px 14px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(90deg, #fb923c, #f97316, #facc15);
      color: #111827;
      font-size: 13px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      cursor: pointer;
      box-shadow: 0 20px 35px rgba(249,115,22,0.65);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    .place-order-btn span.dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #fff;
    }
    .place-order-btn:hover {
      filter: brightness(1.04);
      transform: translateY(-1px);
      box-shadow: 0 24px 40px rgba(249,115,22,0.8);
    }
    .place-order-btn:active {
      transform: translateY(1px);
      box-shadow: 0 10px 18px rgba(0,0,0,0.7);
    }
    .place-order-btn:disabled {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
      transform: none;
    }

    .status {
      margin-top: 6px;
      font-size: 12px;
      min-height: 16px;
      color: var(--text-muted);
    }
    .status.success {
      color: #4ade80;
    }
    .status.error {
      color: #f97373;
    }

    /* Right side (QR) */
    .right-panel-inner {
      background: #020617;
      border-radius: 18px;
      border: 1px solid #1e293b;
      padding: 12px 14px 14px;
      box-shadow: 0 14px 30px rgba(15,23,42,0.9);
    }

    .right-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .right-title {
      font-size: 15px;
      font-weight: 600;
    }
    .right-sub {
      font-size: 11px;
      color: var(--text-muted);
    }

    .live-pill {
      font-size: 11px;
      padding: 4px 9px;
      border-radius: 999px;
      background: rgba(34,197,94,0.12);
      border: 1px solid rgba(34,197,94,0.6);
      color: #bbf7d0;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .live-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: #22c55e;
      box-shadow: 0 0 0 3px rgba(34,197,94,0.4);
    }

    .order-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-muted);
    }
    .order-number {
      font-size: 30px;
      font-weight: 800;
      color: #e5e7eb;
      margin: 2px 0 4px;
    }

    .order-details {
      font-size: 13px;
      margin-bottom: 8px;
      color: #e5e7eb;
    }

    .qr-wrapper {
      margin-top: 8px;
      background: radial-gradient(circle at top, #f9fafb, #e5e7eb);
      border-radius: 16px;
      padding: 12px;
      border: 1px solid #e5e7eb;
    }

    .qr-box {
      background: #fff;
      border-radius: 12px;
      padding: 18px;
      min-height: 190px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .qr-box.empty {
      color: #6b7280;
      font-size: 12px;
      text-align: center;
    }

    .qr-box img {
      max-width: 100%;
      max-height: 210px;
      image-rendering: crisp-edges;
    }

    .hint {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 6px;
    }
    .hint strong {
      color: #e5e7eb;
    }
  </style>
</head>
<body>
  <div class="shell">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <div class="logo-box"></div>
        <div class="header-title">
          <h1>RoboSlice</h1>
          <span>Welcome to RoboSlice the ultimate pizza destination</span>
        </div>
      </div>
      <div class="staff-pill">
        <span class="staff-dot"></span>
      </div>
    </header>

    <!-- PIZZA CARDS (TOP FULL WIDTH) -->
    <section class="card" style="margin-bottom: 18px;">
      <div class="section-title" style="margin-bottom: 10px;">Popular Pizza Delights</div>
      <div class="card-grid" id="pizzaGrid"></div>
    </section>

    <!-- ORDER PANEL (FORM + QR BELOW CARDS) -->
    <section class="order-panel">
      <div class="order-grid">
        <!-- LEFT: FORM + CART -->
        <div>
          <div class="order-title">Roboslice Dine-In Panel</div>
          <div class="order-sub">
            Ready to order? Just fill in the details.
          </div>

          <div class="form-grid">
            <div>
              <div class="field-label">Customer name</div>
              <input type="text" id="customerName" placeholder="e.g. preeti">
            </div>
            <div>
              <div class="field-label">Table / Token (optional)</div>
              <input type="text" id="tableNo" placeholder="e.g. T3, Counter 1">
            </div>
            <div>
              <div class="field-label">Order type</div>
              <select id="orderMode">
                <option value="Dine-In">Dine-In</option>
                <option value="Takeaway">Takeaway</option>
              </select>
            </div>
            <div>
              <div class="field-label">Note (optional)</div>
              <input type="text" id="extraNote" placeholder="Extra cheese, no onion, etc.">
            </div>
          </div>

          <div class="cart-header">Selected items</div>
          <div class="cart-sub">Use <strong>Add +</strong> on any pizza above to add it here.</div>
          <div id="cartContainer"></div>

          <div class="cart-total-row">
            Total: <span class="amount" id="cartTotalDisplay">₹0</span>
          </div>

          <button id="placeOrderBtn" class="place-order-btn">
            <span class="dot"></span>
            Place Order & Generate QR
          </button>

          <div id="status" class="status"></div>
        </div>

        <!-- RIGHT: QR PANEL -->
        <div>
          <div class="right-panel-inner">
            <div class="right-header">
              <div>
                <div class="right-title">Latest Order</div>
                <div class="right-sub">Live QR ticket for scanning at the webcam.</div>
              </div>
              <div class="live-pill">
                <span class="live-dot"></span>
                Live QR ticket
              </div>
            </div>

            <div class="order-label">Order Number</div>
            <div id="orderNoDisplay" class="order-number">—</div>

            <div id="orderDetails" class="order-details">
              No active order yet.
            </div>

            <div class="qr-wrapper">
              <div class="order-label" style="margin-bottom:4px;">QR Ticket Preview</div>
              <div id="qrBox" class="qr-box empty">
                <div>
                  QR will appear here after you place an order.<br><br>
                  Hold this in front of the Logitech camera – it will read the order number
                  and announce it for the robot.
                </div>
              </div>
            </div>

            <p class="hint">
              Hint: keep your Python QR webcam scanner running while taking orders so the robot
              can immediately react when the QR is shown.
            </p>
          </div>
        </div>
      </div>
    </section>
  </div>
  
   

  <script>
    // --- Pizza data (6 cards) ---
  const pizzas = [
  {
    id: "margherita",
    name: "Margherita",
    desc: "Classic delight with 100% real mozzarella cheese.",
    price: 109,
    img: "/static/images/margi.png",
    size: "Regular | New Hand Tossed"
  },
  {
    id: "farmhouse",
    name: "Farmhouse",
    desc: "Onion, capsicum, tomato & grilled mushroom combo.",
    price: 259,
    img: "/static/images/farm.png",
    size: "Regular | New Hand Tossed"
  },
  {
    id: "peppy-paneer",
    name: "Peppy Paneer",
    desc: "Juicy paneer, crisp capsicum & spicy red paprika.",
    price: 259,
    img: "/static/images/peppy.png",
    size: "Regular | New Hand Tossed"
  },
  {
    id: "veggie-paradise",
    name: "Veggie Paradise",
    desc: "Golden corn, black olives, capsicum & red paprika.",
    price: 259,
    img: "/static/images/veggy.png",
    size: "Regular | New Hand Tossed"
  },
  {
    id: "mexican-green-wave",
    name: "Cheese Volcano",
    desc: "Crunchy onions, capsicum, tomato & jalapeno with Mexican herbs.",
    price: 279,
    img: "/static/images/cheese.png",
    size: "Regular | New Hand Tossed"
  },
  {
    id: "chicken-sausage",
    name: "Chicken Sausage",
    desc: "Fresh chicken with mozzarella cheese and oregano flakes.",
    price: 289,
    img: "/static/images/chicken.png",
    size: "Regular | New Hand Tossed"
  }
];



    const pizzaGrid = document.getElementById("pizzaGrid");
    const cartContainer = document.getElementById("cartContainer");
    const cartTotalDisplay = document.getElementById("cartTotalDisplay");
    const statusEl = document.getElementById("status");
    const orderNoDisplay = document.getElementById("orderNoDisplay");
    const orderDetailsEl = document.getElementById("orderDetails");
    const qrBox = document.getElementById("qrBox");
    const placeOrderBtn = document.getElementById("placeOrderBtn");

    // cart data: {id: {name, price, qty}}
    const cart = {};

    // Render pizza cards
    pizzas.forEach(p => {
      const card = document.createElement("div");
      card.className = "pizza-card";

      const imgDiv = document.createElement("div");
      imgDiv.className = "pizza-img";

      // use pizza image
      if (p.img) {
        imgDiv.style.backgroundImage =
          `linear-gradient(135deg, rgba(0,0,0,0.35), rgba(0,0,0,0.05)), url('${p.img}')`;
        imgDiv.style.backgroundSize = "cover";
        imgDiv.style.backgroundPosition = "center";
      }

      const nameOverlay = document.createElement("div");
      nameOverlay.className = "pizza-name-overlay";
      nameOverlay.textContent = p.name;
      imgDiv.appendChild(nameOverlay);

      const body = document.createElement("div");
      body.className = "pizza-body";

      const titleRow = document.createElement("div");
      titleRow.className = "pizza-title-row";
      const titleText = document.createElement("div");
      titleText.className = "pizza-title-text";
      titleText.textContent = p.name;
      const veg = document.createElement("div");
      veg.className = "veg-dot";
      const vegInner = document.createElement("div");
      vegInner.className = "veg-dot-inner";
      veg.appendChild(vegInner);
      titleRow.appendChild(titleText);
      titleRow.appendChild(veg);

      const desc = document.createElement("div");
      desc.className = "pizza-desc";
      desc.textContent = p.desc;

      const bottom = document.createElement("div");
      bottom.className = "card-bottom";
      const priceWrap = document.createElement("div");
      priceWrap.className = "price";
      priceWrap.innerHTML = `₹${p.price}<small>${p.size}</small>`;

      const btn = document.createElement("button");
      btn.className = "add-btn";
      btn.innerHTML = `<span class="dot"></span>Add +`;
      btn.addEventListener("click", () => addToCart(p));

      bottom.appendChild(priceWrap);
      bottom.appendChild(btn);

      body.appendChild(titleRow);
      body.appendChild(desc);
      body.appendChild(bottom);

      card.appendChild(imgDiv);
      card.appendChild(body);

      pizzaGrid.appendChild(card);
    });

    function addToCart(pizza) {
      if (!cart[pizza.id]) {
        cart[pizza.id] = { name: pizza.name, price: pizza.price, qty: 0 };
      }
      cart[pizza.id].qty += 1;
      renderCart();
    }

    function changeQty(id, delta) {
      if (!cart[id]) return;
      cart[id].qty += delta;
      if (cart[id].qty <= 0) {
        delete cart[id];
      }
      renderCart();
    }

    function computeTotal() {
      let total = 0;
      Object.values(cart).forEach(item => {
        total += item.price * item.qty;
      });
      return total;
    }

    function renderCart() {
      const entries = Object.entries(cart);
      if (entries.length === 0) {
        cartContainer.innerHTML =
          `<div class="cart-empty">No items added yet. Use <strong>Add +</strong> on a pizza card.</div>`;
        cartTotalDisplay.textContent = "₹0";
        return;
      }

      let html = `
        <table class="cart-table">
          <thead>
            <tr>
              <th>Item</th>
              <th>Qty</th>
              <th>Price</th>
              <th>Sub</th>
            </tr>
          </thead>
          <tbody>
      `;

      entries.forEach(([id, item]) => {
        const sub = item.price * item.qty;
        html += `
          <tr>
            <td>${item.name}</td>
            <td>
              <div class="qty-controls">
                <button class="qty-btn" onclick="changeQty('${id}', -1)">-</button>
                <span class="qty-value">${item.qty}</span>
                <button class="qty-btn" onclick="changeQty('${id}', 1)">+</button>
              </div>
            </td>
            <td>₹${item.price}</td>
            <td>₹${sub}</td>
          </tr>
        `;
      });

      html += `</tbody></table>`;
      cartContainer.innerHTML = html;
      cartTotalDisplay.textContent = "₹" + computeTotal();
    }

    // expose changeQty for inline onclick
    window.changeQty = changeQty;

    // Place order handler
    placeOrderBtn.addEventListener("click", async () => {
      const entries = Object.values(cart);
      statusEl.textContent = "";
      statusEl.className = "status";

      if (entries.length === 0) {
        statusEl.textContent = "Add at least one pizza before placing order.";
        statusEl.classList.add("error");
        return;
      }

      const customerName = document.getElementById("customerName").value.trim();
      const orderMode = document.getElementById("orderMode").value;
      const tableNo = document.getElementById("tableNo").value.trim();
      const note = document.getElementById("extraNote").value.trim();
      const total = computeTotal();

      const summary = entries.map(item => `${item.name} x${item.qty}`).join(", ");

      placeOrderBtn.disabled = true;
      placeOrderBtn.textContent = "Placing order...";

      try {
        const res = await fetch("/api/orders", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            customerName,
            pizzaType: summary,
            orderMode,
            tableNo,
            note,
            items: entries,
            total: total
          })
        });

        if (!res.ok) {
          throw new Error("Server error " + res.status);
        }

        const data = await res.json();

        orderNoDisplay.textContent = "#" + data.orderNo;

        let details = `${data.orderMode} · ${data.pizzaType}`;
        if (data.customerName) details += ` · ${data.customerName}`;
        if (data.tableNo) details += ` · ${data.tableNo}`;
        details += ` · Total ₹${total}`;
        orderDetailsEl.textContent = details;

        qrBox.classList.remove("empty");
        qrBox.innerHTML = "";
        const img = document.createElement("img");
        img.src = data.qrUrl + "?t=" + Date.now();
        img.alt = "QR for order " + data.orderNo;
        qrBox.appendChild(img);

        statusEl.textContent = `Order #${data.orderNo} placed. Total ₹${total}. QR generated.`;
        statusEl.classList.add("success");

        // Clear cart after success
        for (const key of Object.keys(cart)) delete cart[key];
        renderCart();
      } catch (err) {
        console.error(err);
        statusEl.textContent = "Failed to place order. Check server and try again.";
        statusEl.classList.add("error");
      } finally {
        placeOrderBtn.disabled = false;
        placeOrderBtn.textContent = "Place Order & Generate QR";
      }
    });

    // Initial cart render
    renderCart();
  </script>
</body>
</html>
